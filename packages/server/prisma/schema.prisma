generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Location {
  id             String       @id @default(cuid())
  address        String?
  latitude       Float?
  longitude      Float?
  type           LocationType @default(BRANCH)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organizationId String
  employees      Employee[]   @relation("EmployeeLocation")
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  routes         Route[]

  @@map("locations")
}

model Department {
  id             String       @id @default(cuid())
  name           String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  employees      Employee[]

  @@index([organizationId])
  @@map("departments")
}

model Shift {
  id                  String                @id @default(cuid())
  name                String
  startTime           DateTime
  endTime             DateTime
  timeZone            String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  organizationId      String
  employees           Employee[]
  routes              Route[]
  organization        Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  vehicleAvailability VehicleAvailability[]

  @@index([organizationId])
  @@map("shifts")
}

model Employee {
  id             String       @id @default(cuid())
  name           String
  location       String?
  assigned       Boolean      @default(false)
  departmentId   String
  shiftId        String
  stopId         String?      @unique
  deleted        Boolean      @default(false)
  deletedAt      DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organizationId String
  userId         String
  locationId     String?
  department     Department   @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  workLocation   Location?    @relation("EmployeeLocation", fields: [locationId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  shift          Shift        @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  stop           Stop?        @relation(fields: [stopId], references: [id])
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([assigned])
  @@index([organizationId])
  @@index([departmentId])
  @@index([shiftId])
  @@index([deleted, deletedAt])
  @@map("employees")
}

model Driver {
  id                  String                @id @default(cuid())
  name                String
  email               String?
  licenseNumber       String
  experienceYears     Int?
  isActive            Boolean               @default(true)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  deleted             Boolean               @default(false)
  deletedAt           DateTime?
  phoneNumber         String?
  rating              Float?                @default(0.0)
  organizationId      String
  status              DriverStatus          @default(ACTIVE)
  organization        Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  payrollReports      PayrollReport[]
  vehicleAvailability VehicleAvailability[]
  assignedVehicles    Vehicle[]             @relation("VehicleDriver")

  @@unique([organizationId, email])
  @@unique([organizationId, licenseNumber])
  @@unique([organizationId, phoneNumber])
  @@index([organizationId])
  @@index([status])
  @@index([isActive])
  @@index([deleted, deletedAt])
  @@map("drivers")
}

model VehicleCategory {
  id              String           @id @default(cuid())
  name            String
  capacity        Int              @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  organizationId  String
  organization    Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  vehicleRequests VehicleRequest[]
  vehicles        Vehicle[]

  @@index([organizationId])
  @@map("vehicle_categories")
}

model Vehicle {
  id                  String                @id @default(cuid())
  plateNumber         String                @unique
  model               String
  capacity            Int
  year                Int?
  status              VehicleStatus         @default(AVAILABLE)
  lastMaintenance     DateTime?
  isActive            Boolean               @default(true)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  categoryId          String?
  dailyRate           Decimal?              @db.Decimal(10, 2)
  deleted             Boolean               @default(false)
  deletedAt           DateTime?
  driverId            String?
  make                String?
  name                String?
  nextMaintenance     DateTime?
  vendor              String?
  organizationId      String
  type                VehicleType           @default(IN_HOUSE)
  payrollReports      PayrollReport[]
  routes              Route[]
  vehicleAvailability VehicleAvailability[]
  category            VehicleCategory?      @relation(fields: [categoryId], references: [id])
  driver              Driver?               @relation("VehicleDriver", fields: [driverId], references: [id])
  organization        Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([categoryId])
  @@index([driverId])
  @@index([status])
  @@index([type])
  @@index([isActive])
  @@index([deleted, deletedAt])
  @@map("vehicles")
}

model Route {
  id                  String                @id @default(cuid())
  name                String
  description         String?
  isActive            Boolean               @default(true)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  date                DateTime?
  deleted             Boolean               @default(false)
  deletedAt           DateTime?
  endTime             DateTime?
  shiftId             String?
  startTime           DateTime?
  status              RouteStatus           @default(ACTIVE)
  totalDistance       Float?
  totalTime           Float?
  vehicleId           String?
  organizationId      String
  locationId          String?
  location            Location?             @relation(fields: [locationId], references: [id])
  organization        Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  shift               Shift?                @relation(fields: [shiftId], references: [id])
  vehicle             Vehicle?              @relation(fields: [vehicleId], references: [id])
  stops               Stop[]
  vehicleAvailability VehicleAvailability[]

  @@index([organizationId])
  @@index([vehicleId])
  @@index([shiftId])
  @@index([locationId])
  @@map("routes")
}

model Stop {
  id                   String       @id @default(cuid())
  name                 String
  latitude             Float?
  longitude            Float?
  address              String?
  order                Int          @default(0)
  routeId              String?
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  estimatedArrivalTime DateTime?
  sequence             Int?         @default(0)
  organizationId       String
  employee             Employee?
  organization         Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  route                Route?       @relation(fields: [routeId], references: [id])

  @@index([organizationId])
  @@index([routeId])
  @@map("stops")
}

model VehicleAvailability {
  id             String       @id @default(cuid())
  date           DateTime
  startTime      DateTime
  endTime        DateTime
  vehicleId      String
  driverId       String
  routeId        String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  available      Boolean      @default(true)
  shiftId        String?
  organizationId String
  driver         Driver       @relation(fields: [driverId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  route          Route?       @relation(fields: [routeId], references: [id])
  shift          Shift?       @relation(fields: [shiftId], references: [id])
  vehicle        Vehicle      @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@unique([vehicleId, shiftId, date])
  @@index([organizationId])
  @@index([vehicleId])
  @@index([driverId])
  @@index([routeId])
  @@index([shiftId])
  @@index([date])
  @@map("vehicle_availability")
}

model PayrollReport {
  id              String        @id @default(cuid())
  period          String
  totalAmount     Float?
  hoursWorked     Float?
  overtimeHours   Float?
  deductions      Float?
  bonuses         Float?
  generatedAt     DateTime      @default(now())
  paidAt          DateTime?
  driverId        String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  dailyRate       Decimal?      @db.Decimal(10, 2)
  efficiency      Int           @default(0)
  insuranceCost   Decimal?      @db.Decimal(10, 2)
  maintenanceCost Decimal?      @db.Decimal(10, 2)
  month           String?
  otherExpenses   Decimal?      @db.Decimal(10, 2)
  payDate         DateTime?
  status          PaymentStatus @default(PENDING)
  totalPayment    Decimal       @db.Decimal(10, 2)
  utilizationRate Int           @default(0)
  vehicleId       String?
  workedDays      Int?
  year            Int?
  organizationId  String
  driver          Driver?       @relation(fields: [driverId], references: [id])
  organization    Organization  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  vehicle         Vehicle?      @relation(fields: [vehicleId], references: [id])

  @@index([organizationId])
  @@index([vehicleId])
  @@index([driverId])
  @@index([period])
  @@map("payroll_reports")
}

model Notification {
  id              String             @id @default(cuid())
  title           String
  message         String
  type            NotificationType   @default(INFO)
  status          NotificationStatus @default(UNREAD)
  userId          String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  fromRole        String?
  localTime       String?
  relatedEntityId String?
  toRoles         String[]
  organizationId  String
  importance      ImportanceLevel    @default(MEDIUM)
  seenBy          NotificationSeen[] @relation("NotificationSeenBy")
  organization    Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([userId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationSeen {
  id             String       @id @default(cuid())
  userId         String
  notificationId String
  seenAt         DateTime     @default(now())
  readAt         DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  notification   Notification @relation("NotificationSeenBy", fields: [notificationId], references: [id], onDelete: Cascade)
  user           User         @relation("UserSeenNotifications", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, notificationId])
  @@index([userId])
  @@index([notificationId])
  @@map("notification_seen")
}

model VehicleRequest {
  id             String           @id @default(cuid())
  name           String
  licensePlate   String
  categoryId     String?
  dailyRate      Float?
  capacity       Int
  type           String
  model          String
  vendor         String?
  status         ApprovalStatus   @default(PENDING)
  requestedBy    String
  approvedBy     String?
  approvedAt     DateTime?
  comment        String?
  requestedAt    DateTime         @default(now())
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  organizationId String
  category       VehicleCategory? @relation(fields: [categoryId], references: [id])
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([categoryId])
  @@map("vehicle_requests")
}

model User {
  id                String             @id
  name              String
  email             String             @unique
  emailVerified     Boolean
  image             String?
  createdAt         DateTime
  updatedAt         DateTime
  role              String?
  banned            Boolean?
  banReason         String?
  banExpires        DateTime?
  isSubscribed      Boolean?
  accounts          Account[]
  employees         Employee[]
  invitations       Invitation[]
  members           Member[]
  seenNotifications NotificationSeen[] @relation("UserSeenNotifications")
  sessions          Session[]

  @@map("user")
}

model Session {
  id                   String   @id
  expiresAt            DateTime
  token                String   @unique
  createdAt            DateTime
  updatedAt            DateTime
  ipAddress            String?
  userAgent            String?
  userId               String
  impersonatedBy       String?
  activeOrganizationId String?
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Organization {
  id                  String                @id
  name                String
  slug                String?               @unique
  logo                String?
  createdAt           DateTime
  metadata            String?
  departments         Department[]
  drivers             Driver[]
  employees           Employee[]
  invitations         Invitation[]
  locations           Location[]
  members             Member[]
  notifications       Notification[]
  payrollReports      PayrollReport[]
  routes              Route[]
  shifts              Shift[]
  stops               Stop[]
  vehicleAvailability VehicleAvailability[]
  vehicleCategories   VehicleCategory[]
  vehicleRequests     VehicleRequest[]
  vehicles            Vehicle[]

  @@map("organization")
}

model Member {
  id             String       @id
  organizationId String
  userId         String
  role           String
  createdAt      DateTime
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("member")
}

model Invitation {
  id             String       @id
  organizationId String
  email          String
  role           String?
  status         String
  expiresAt      DateTime
  inviterId      String
  user           User         @relation(fields: [inviterId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("invitation")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

enum Role {
  admin
  manager
  driver
  superadmin
  owner
  employee
}

enum VehicleStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  OUT_OF_SERVICE
  INACTIVE
}

enum NotificationType {
  INFO
  WARNING
  ALERT
  SYSTEM
  VEHICLE_CREATED
  VEHICLE_UPDATED
  VEHICLE_DELETED
  VEHICLE_MAINTENANCE
  VEHICLE_STATUS_CHANGED
  VEHICLE_ASSIGNED
  VEHICLE_UNASSIGNED
  ROUTE_CREATED
  ROUTE_UPDATED
  ROUTE_DELETED
  ROUTE_ACTIVATED
  ROUTE_DEACTIVATED
  ROUTE_ASSIGNED
  ROUTE_UNASSIGNED
  ROUTE_MODIFIED
  ROUTE_CANCELLED
  ROUTE_DELAY
  ROUTE_STARTED
  ROUTE_COMPLETED
  ROUTE_OPTIMIZED
  EMPLOYEE_CREATED
  EMPLOYEE_UPDATED
  EMPLOYEE_DELETED
  EMPLOYEE_ASSIGNED_ROUTE
  EMPLOYEE_REMOVED_ROUTE
  EMPLOYEE_BULK_IMPORT
  EMPLOYEE_DEPARTMENT_CHANGED
  EMPLOYEE_SHIFT_CHANGED
  EMPLOYEE_STOP_CHANGED
  DRIVER_CREATED
  DRIVER_UPDATED
  DRIVER_DELETED
  DRIVER_STATUS_CHANGED
  DRIVER_LICENSE_EXPIRY
  DRIVER_AVAILABILITY_CHANGED
  DRIVER_SHIFT_ASSIGNED
  DEPARTMENT_CREATED
  DEPARTMENT_UPDATED
  DEPARTMENT_DELETED
  SHIFT_CREATED
  SHIFT_UPDATED
  SHIFT_DELETED
  SHIFT_TIME_CHANGED
  REQUEST_CREATED
  REQUEST_APPROVED
  REQUEST_REJECTED
  REQUEST_CANCELLED
  REQUEST_PENDING
  AVAILABILITY_CREATED
  AVAILABILITY_UPDATED
  AVAILABILITY_DELETED
  VEHICLE_OVERBOOKED
  LOW_AVAILABILITY
  STOP_CREATED
  STOP_UPDATED
  STOP_DELETED
  STOP_RELOCATED
  ORG_CREATED
  ORG_UPDATED
  ORG_DELETED
  ORG_SUSPENDED
  ORG_SUBSCRIPTION_EXPIRING
  ORG_USER_LIMIT
  ORG_STORAGE_WARNING
  USER_INVITED
  USER_JOINED
  USER_ROLE_CHANGED
  USER_REMOVED
  USER_ACCESS_REVOKED
  USER_REACTIVATED
  PERMISSIONS_UPDATED
  ACCOUNT_SUSPENDED
  PAYROLL_GENERATED
  PAYROLL_APPROVED
  PAYROLL_AVAILABLE
  PAYMENT_PROCESSED
  PAYROLL_ISSUE
  REPORT_GENERATED
  REPORT_EXPORTED
  SYSTEM_MAINTENANCE_SCHEDULED
  SYSTEM_MAINTENANCE_STARTED
  SYSTEM_MAINTENANCE_COMPLETED
  SYSTEM_BACKUP_COMPLETED
  SYSTEM_BACKUP_FAILED
  SYSTEM_UPDATE_AVAILABLE
  SYSTEM_PERFORMANCE_ALERT
  SYSTEM_SECURITY_ALERT
  SERVICE_OUTAGE
  SUSPICIOUS_ACTIVITY
  DATA_EXPORTED
  BULK_DELETE
  CONFIG_CHANGED
}

enum NotificationStatus {
  UNREAD
  READ
  ARCHIVED
}

enum RouteStatus {
  ACTIVE
  INACTIVE
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PROCESSED
  CANCELLED
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum DriverStatus {
  ACTIVE
  OFF_DUTY
  ON_BREAK
  INACTIVE
}

enum VehicleType {
  IN_HOUSE
  OUTSOURCED
}

enum ImportanceLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum LocationType {
  BRANCH
  HQ
}
